# 2.2.1 Spark Memory



이번 챕터에서는 Spark 의 메모리 구조에 대해서 알아보겠습니다.\


Spark 는 JVM 위에서 실행됩니다. PySpark 를 쓰는 경우에는 외부에 Python 프로세스가 존재할 수 있으나 Driver 또는 Executor 를 위한 JVM 이 실행되는건 동일합니다.\


지난 챕터에서 Spark 모드에 따른 구분에서 알아보았듯이 Spark 는 다양한 실행 모드를 지원하고 각 실행 모드에 따라 컴포넌트의 실행 위치가 달라지게 됩니다.

* Local 모드라면 단일 JVM 내에 Driver 와 Executor 가 존재합니다
* Client 모드라면 Driver JVM 과 다수의 Executor JVM 이 존재합니다
* Cluster 모드라면, JVM 기준으로 Client 모드와 동일하되 Job 을 Submit / Wait 하는 JVM 이 존재할 수 있습니다.



![Spark Local Mode (Spark in Action)](<../../.gitbook/assets/image (12).png>)

![Spark Client Mode (Spark in Action)](<../../.gitbook/assets/image (18).png>)

![Spark Cluster Mode (Spark in Action)](<../../.gitbook/assets/image (3).png>)



### Spark Memory Config



Spark 에서는 위 사진에 나온 다양한 컴포넌트들의 메모리를 조절할 수 있는 옵션을 제공합니다.

* [Spark Configuration](https://spark.apache.org/docs/latest/configuration.html)
* [Spark Configuration - Memory Management](https://spark.apache.org/docs/latest/configuration.html#memory-management)
* [Running Spark on Kubernetes](https://spark.apache.org/docs/latest/running-on-kubernetes.html)

| Configuration                           | Description |
| --------------------------------------- | ----------- |
| spark.driver.cores                      |             |
| spark.driver.memory                     |             |
| spark.driver.memoryOverhead             |             |
|                                         |             |
| spark.executor.cores                    |             |
| spark.executor.memory                   |             |
| spark.executor.memoryOverhead           |             |
| spark.executor.pyspark.memory           |             |
|                                         |             |
| spark.memory.fraction                   |             |
| spark.memory.storageFraction            |             |
| spark.memory.offHeap.enabled            |             |
| spark.memory.offHeap.size               |             |
| spark.python.worker.memory              |             |
|                                         |             |
| spark.kubernetes.driver.limit.cores     |             |
| spark.kubernetes.executor.limits.cores  |             |
| spark.kubernetes.driver.request.cores   |             |
| spark.kubernetes.executor.request.cores |             |
| spark.kubernetes.memoryOverheadFactor   |             |



### Spark Memory Area







### Spark on EMR Yarn



### Spark on Kubernetes



